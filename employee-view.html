<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="æ’ç­æŸ¥è©¢ç³»çµ± - å“¡å·¥æª¢è¦–">
    <meta name="author" content="DK0124">
    <title>æ’ç­æŸ¥è©¢ç³»çµ±</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ“…</text></svg>">
    
    <style>
        /* CSS è®Šæ•¸å®šç¾© */
        :root {
            --primary: #007AFF;
            --secondary: #5AC8FA;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --dark: #1C1C1E;
            --gray: #8E8E93;
            --light: #F2F2F7;
            --surface: #FFFFFF;
            --border: #E5E5EA;
            --shadow: 0 2px 8px rgba(0,0,0,0.08);
            --radius: 12px;
        }

        /* æ·±è‰²æ¨¡å¼ */
        @media (prefers-color-scheme: dark) {
            :root {
                --dark: #F5F5F7;
                --light: #1C1C1E;
                --surface: #2C2C2E;
                --border: #3A3A3C;
                --shadow: 0 2px 8px rgba(0,0,0,0.3);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* æ¨™é¡Œå€ */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .last-update {
            background: rgba(255,255,255,0.2);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 10px;
        }

        /* å“¡å·¥é¸æ“‡å™¨ */
        .employee-selector {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .selector-group {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-select {
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            background: var(--surface);
            color: var(--dark);
            min-width: 200px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0051D5;
            transform: translateY(-2px);
        }

        /* æª¢è¦–åˆ‡æ› */
        .view-toggle {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .view-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--dark);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
        }

        /* æ’ç­å¡ç‰‡ */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .schedule-card {
            background: var(--surface);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .schedule-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .card-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-date {
            font-size: 20px;
            font-weight: 600;
        }

        .card-weekday {
            font-size: 14px;
            opacity: 0.9;
        }

        .card-body {
            padding: 20px;
        }

        .no-schedule {
            text-align: center;
            color: var(--gray);
            padding: 30px;
        }

        .shift-item {
            padding: 12px;
            background: var(--light);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .shift-time {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shift-employees {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .employee-badge {
            background: var(--surface);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 13px;
            border: 1px solid var(--border);
        }

        .employee-badge.me {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            font-weight: 600;
        }

        /* ä»Šæ—¥æ¨™è¨˜ */
        .today-badge {
            background: var(--success);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        /* çµ±è¨ˆå€ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
            margin-top: 5px;
        }

        /* åˆ—è¡¨æª¢è¦– */
        .list-view {
            background: var(--surface);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .list-header {
            display: grid;
            grid-template-columns: 100px 150px 1fr 100px;
            padding: 15px 20px;
            background: var(--light);
            font-weight: 600;
            font-size: 14px;
            color: var(--gray);
        }

        .list-item {
            display: grid;
            grid-template-columns: 100px 150px 1fr 100px;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .list-item:hover {
            background: var(--light);
        }

        .list-date {
            font-weight: 600;
        }

        .list-time {
            color: var(--primary);
            font-weight: 500;
        }

        /* ç©ºç‹€æ…‹ */
        .empty-state {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 60px 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .empty-text {
            color: var(--gray);
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }
            
            .schedule-grid {
                grid-template-columns: 1fr;
            }

            .list-header,
            .list-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .list-header {
                display: none;
            }

            .list-item > * {
                padding: 5px 0;
            }
        }

        /* åˆ—å°æ¨£å¼ */
        @media print {
            body {
                background: white;
            }

            .employee-selector,
            .view-toggle,
            .btn {
                display: none !important;
            }

            .schedule-card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œå€ -->
        <div class="header">
            <h1>ğŸ“… æ’ç­æŸ¥è©¢ç³»çµ±</h1>
            <p>æŸ¥çœ‹æ‚¨çš„æ’ç­è³‡è¨Š</p>
            <div class="last-update" id="lastUpdate">
                æœ€å¾Œæ›´æ–°ï¼šè¼‰å…¥ä¸­...
            </div>
        </div>

        <!-- å“¡å·¥é¸æ“‡å™¨ -->
        <div class="employee-selector">
            <div class="selector-group">
                <select class="form-select" id="employeeSelect">
                    <option value="">é¸æ“‡å“¡å·¥æŸ¥çœ‹æ’ç­</option>
                    <option value="all">æŸ¥çœ‹æ‰€æœ‰å“¡å·¥</option>
                </select>
                <select class="form-select" id="monthSelect">
                    <!-- å‹•æ…‹ç”Ÿæˆæœˆä»½é¸é … -->
                </select>
                <button class="btn btn-primary" onclick="EmployeeView.loadSchedule()">
                    ğŸ” æŸ¥è©¢æ’ç­
                </button>
                <button class="btn btn-primary" onclick="EmployeeView.refresh()">
                    ğŸ”„ é‡æ–°æ•´ç†
                </button>
            </div>
        </div>

        <!-- çµ±è¨ˆå€ -->
        <div class="stats-container" id="statsContainer" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalShifts">0</div>
                <div class="stat-label">æœ¬æœˆç¸½ç­æ¬¡</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalHours">0</div>
                <div class="stat-label">ç¸½å·¥æ™‚ï¼ˆå°æ™‚ï¼‰</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="morningShifts">0</div>
                <div class="stat-label">æ—©ç­æ¬¡æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="eveningShifts">0</div>
                <div class="stat-label">æ™šç­æ¬¡æ•¸</div>
            </div>
        </div>

        <!-- æª¢è¦–åˆ‡æ› -->
        <div class="view-toggle" id="viewToggle" style="display: none;">
            <button class="view-btn active" onclick="EmployeeView.switchView('grid')">ğŸ“… å¡ç‰‡æª¢è¦–</button>
            <button class="view-btn" onclick="EmployeeView.switchView('list')">ğŸ“‹ åˆ—è¡¨æª¢è¦–</button>
            <button class="view-btn" onclick="EmployeeView.switchView('calendar')">ğŸ—“ï¸ æœˆæ›†æª¢è¦–</button>
        </div>

        <!-- æ’ç­é¡¯ç¤ºå€ -->
        <div id="scheduleContent">
            <div class="empty-state">
                <div class="empty-icon">ğŸ‘†</div>
                <div class="empty-title">è«‹é¸æ“‡å“¡å·¥</div>
                <div class="empty-text">é¸æ“‡å“¡å·¥å’Œæœˆä»½ä»¥æŸ¥çœ‹æ’ç­è³‡è¨Š</div>
            </div>
        </div>
    </div>

    <script>
        // å“¡å·¥æª¢è¦–æ‡‰ç”¨ç¨‹å¼
        const EmployeeView = {
            employees: [],
            schedules: {},
            shifts: [],
            currentView: 'grid',
            selectedEmployee: null,
            selectedMonth: null,
            
            // åˆå§‹åŒ–
            init() {
                this.loadData();
                this.setupMonthSelector();
                this.renderEmployeeSelector();
                this.updateLastSync();
                
                // æ¯30ç§’è‡ªå‹•æ›´æ–°
                setInterval(() => {
                    this.refresh();
                }, 30000);
            },
            
            // è¼‰å…¥è³‡æ–™
            loadData() {
                const saved = localStorage.getItem('scheduleData');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.employees = data.employees || [];
                    this.schedules = data.schedules || {};
                    this.shifts = data.shifts || [];
                }
            },
            
            // è¨­å®šæœˆä»½é¸æ“‡å™¨
            setupMonthSelector() {
                const select = document.getElementById('monthSelect');
                const currentDate = new Date();
                const currentYear = currentDate.getFullYear();
                const currentMonth = currentDate.getMonth();
                
                // ç”Ÿæˆå‰å¾Œ3å€‹æœˆçš„é¸é …
                for (let i = -3; i <= 3; i++) {
                    const date = new Date(currentYear, currentMonth + i, 1);
                    const option = document.createElement('option');
                    option.value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    option.textContent = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ`;
                    
                    if (i === 0) {
                        option.selected = true;
                        this.selectedMonth = option.value;
                    }
                    
                    select.appendChild(option);
                }
                
                select.onchange = (e) => {
                    this.selectedMonth = e.target.value;
                };
            },
            
            // æ¸²æŸ“å“¡å·¥é¸æ“‡å™¨
            renderEmployeeSelector() {
                const select = document.getElementById('employeeSelect');
                
                // ä¿ç•™å‰å…©å€‹é¸é …
                while (select.options.length > 2) {
                    select.remove(2);
                }
                
                this.employees.forEach(emp => {
                    const option = document.createElement('option');
                    option.value = emp.id;
                    option.textContent = `${emp.name} (${emp.type === 'fulltime' ? 'æ­£è·' : 'PT'})`;
                    select.appendChild(option);
                });
                
                select.onchange = (e) => {
                    this.selectedEmployee = e.target.value;
                };
            },
            
            // æ›´æ–°æœ€å¾ŒåŒæ­¥æ™‚é–“
            updateLastSync() {
                const saved = localStorage.getItem('scheduleData');
                if (saved) {
                    const data = JSON.parse(saved);
                    const lastUpdate = new Date(data.lastUpdated);
                    document.getElementById('lastUpdate').textContent = 
                        `æœ€å¾Œæ›´æ–°ï¼š${lastUpdate.toLocaleString('zh-TW')}`;
                }
            },
            
            // é‡æ–°æ•´ç†
            refresh() {
                this.loadData();
                this.renderEmployeeSelector();
                this.updateLastSync();
                if (this.selectedEmployee) {
                    this.loadSchedule();
                }
            },
            
            // è¼‰å…¥æ’ç­
            loadSchedule() {
                if (!this.selectedEmployee || !this.selectedMonth) {
                    this.showEmpty('è«‹é¸æ“‡å“¡å·¥å’Œæœˆä»½');
                    return;
                }
                
                document.getElementById('statsContainer').style.display = 'grid';
                document.getElementById('viewToggle').style.display = 'flex';
                
                const schedules = this.getEmployeeSchedules();
                this.updateStats(schedules);
                
                if (schedules.length === 0) {
                    this.showEmpty('æœ¬æœˆç„¡æ’ç­');
                } else {
                    this.renderSchedules(schedules);
                }
            },
            
            // å–å¾—å“¡å·¥æ’ç­
            getEmployeeSchedules() {
                const schedules = [];
                const [year, month] = this.selectedMonth.split('-');
                
                Object.entries(this.schedules).forEach(([date, daySchedules]) => {
                    if (date.startsWith(this.selectedMonth)) {
                        daySchedules.forEach(schedule => {
                            if (this.selectedEmployee === 'all' || 
                                schedule.employeeId == this.selectedEmployee) {
                                schedules.push({
                                    date,
                                    ...schedule,
                                    employeeName: this.getEmployeeName(schedule.employeeId)
                                });
                            }
                        });
                    }
                });
                
                return schedules.sort((a, b) => a.date.localeCompare(b.date));
            },
            
            // æ›´æ–°çµ±è¨ˆ
            updateStats(schedules) {
                let totalHours = 0;
                let morningCount = 0;
                let eveningCount = 0;
                
                schedules.forEach(schedule => {
                    const hours = this.calculateHours(schedule.startTime, schedule.endTime);
                    totalHours += hours;
                    
                    const startHour = parseInt(schedule.startTime.split(':')[0]);
                    if (startHour < 12) {
                        morningCount++;
                    } else {
                        eveningCount++;
                    }
                });
                
                document.getElementById('totalShifts').textContent = schedules.length;
                document.getElementById('totalHours').textContent = Math.round(totalHours);
                document.getElementById('morningShifts').textContent = morningCount;
                document.getElementById('eveningShifts').textContent = eveningCount;
            },
            
            // è¨ˆç®—å·¥æ™‚
            calculateHours(startTime, endTime) {
                const [startH, startM] = startTime.split(':').map(Number);
                const [endH, endM] = endTime.split(':').map(Number);
                
                let hours = endH - startH;
                let minutes = endM - startM;
                
                if (minutes < 0) {
                    hours--;
                    minutes += 60;
                }
                
                if (hours < 0) {
                    hours += 24; // è·¨æ—¥
                }
                
                return hours + minutes / 60;
            },
            
            // æ¸²æŸ“æ’ç­
            renderSchedules(schedules) {
                const content = document.getElementById('scheduleContent');
                
                if (this.currentView === 'grid') {
                    this.renderGridView(schedules, content);
                } else if (this.currentView === 'list') {
                    this.renderListView(schedules, content);
                } else {
                    this.renderCalendarView(schedules, content);
                }
            },
            
            // ç¶²æ ¼æª¢è¦–
            renderGridView(schedules, container) {
                // æŒ‰æ—¥æœŸåˆ†çµ„
                const groupedSchedules = {};
                schedules.forEach(schedule => {
                    if (!groupedSchedules[schedule.date]) {
                        groupedSchedules[schedule.date] = [];
                    }
                    groupedSchedules[schedule.date].push(schedule);
                });
                
                let html = '<div class="schedule-grid">';
                
                Object.entries(groupedSchedules).forEach(([date, daySchedules]) => {
                    const dateObj = new Date(date + 'T00:00:00');
                    const weekdays = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
                    const isToday = date === new Date().toISOString().split('T')[0];
                    
                    html += `
                        <div class="schedule-card">
                            <div class="card-header">
                                <div>
                                    <div class="card-date">${dateObj.getDate()}æ—¥</div>
                                    <div class="card-weekday">${weekdays[dateObj.getDay()]}</div>
                                </div>
                                ${isToday ? '<span class="today-badge">ä»Šå¤©</span>' : ''}
                            </div>
                            <div class="card-body">
                    `;
                    
                    // æŒ‰æ™‚é–“åˆ†çµ„
                    const timeGroups = {};
                    daySchedules.forEach(schedule => {
                        const key = `${schedule.startTime}-${schedule.endTime}`;
                        if (!timeGroups[key]) {
                            timeGroups[key] = [];
                        }
                        timeGroups[key].push(schedule);
                    });
                    
                    Object.entries(timeGroups).forEach(([time, schedules]) => {
                        html += `
                            <div class="shift-item">
                                <div class="shift-time">
                                    ğŸ• ${time}
                                </div>
                                <div class="shift-employees">
                        `;
                        
                        schedules.forEach(schedule => {
                            const isMe = schedule.employeeId == this.selectedEmployee;
                            html += `<span class="employee-badge ${isMe ? 'me' : ''}">${schedule.employeeName}</span>`;
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            },
            
            // åˆ—è¡¨æª¢è¦–
            renderListView(schedules, container) {
                let html = `
                    <div class="list-view">
                        <div class="list-header">
                            <div>æ—¥æœŸ</div>
                            <div>æ™‚é–“</div>
                            <div>å“¡å·¥</div>
                            <div>å·¥æ™‚</div>
                        </div>
                `;
                
                schedules.forEach(schedule => {
                    const dateObj = new Date(schedule.date + 'T00:00:00');
                    const hours = this.calculateHours(schedule.startTime, schedule.endTime);
                    
                    html += `
                        <div class="list-item">
                            <div class="list-date">${dateObj.getMonth() + 1}/${dateObj.getDate()}</div>
                            <div class="list-time">${schedule.startTime} - ${schedule.endTime}</div>
                            <div>${schedule.employeeName}</div>
                            <div>${hours.toFixed(1)}h</div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            },
            
            // æœˆæ›†æª¢è¦–
            renderCalendarView(schedules, container) {
                // é€™è£¡å¯ä»¥å¯¦ä½œå®Œæ•´çš„æœˆæ›†æª¢è¦–
                this.renderGridView(schedules, container); // æš«æ™‚ä½¿ç”¨ç¶²æ ¼æª¢è¦–
            },
            
            // åˆ‡æ›æª¢è¦–
            switchView(view) {
                this.currentView = view;
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                if (this.selectedEmployee) {
                    this.loadSchedule();
                }
            },
            
            // é¡¯ç¤ºç©ºç‹€æ…‹
            showEmpty(message) {
                document.getElementById('statsContainer').style.display = 'none';
                document.getElementById('viewToggle').style.display = 'none';
                document.getElementById('scheduleContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <div class="empty-title">${message}</div>
                        <div class="empty-text">è«‹ç¢ºèªé¸æ“‡æ¢ä»¶æˆ–è¯ç¹«ç®¡ç†å“¡</div>
                    </div>
                `;
            },
            
            // å–å¾—å“¡å·¥å§“å
            getEmployeeName(id) {
                const emp = this.employees.find(e => e.id == id);
                return emp ? emp.name : 'æœªçŸ¥';
            }
        };
        
        // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
        document.addEventListener('DOMContentLoaded', () => {
            EmployeeView.init();
        });
    </script>
</body>
</html>