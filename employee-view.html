<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="æ’ç­æŸ¥è©¢ç³»çµ± - å“¡å·¥æª¢è¦–">
    <meta name="author" content="Bleu">
    <title>æ’ç­æŸ¥è©¢ç³»çµ± - Bleu</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ“…</text></svg>">
    
    <style>
        /* Bleu å“ç‰Œè‰²ç³» */
        :root {
            --dk-primary: #003D52;
            --dk-secondary: #83968B;
            --dk-accent: #EE7836;
            --dk-light: #BCDBE4;
            --dk-white: #FFFFFF;
            --dk-gray-light: #F5F7F8;
            --dk-gray: #E0E5E7;
            --dk-gray-dark: #6B7C74;
            --dk-text: #2C3E50;
            --dk-shadow: 0 2px 12px rgba(0, 61, 82, 0.08);
            --dk-shadow-hover: 0 4px 20px rgba(0, 61, 82, 0.12);
            --dk-radius: 10px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, var(--dk-light) 0%, var(--dk-gray-light) 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* æ¨™é¡Œå€ */
        .header {
            text-align: center;
            color: var(--dk-primary);
            margin-bottom: 30px;
            padding: 30px;
            background: var(--dk-white);
            border-radius: var(--dk-radius);
            box-shadow: var(--dk-shadow);
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            color: var(--dk-gray-dark);
        }

        .last-update {
            background: var(--dk-light);
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 15px;
            color: var(--dk-primary);
            font-weight: 500;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: var(--dk-white);
            border-radius: var(--dk-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--dk-shadow);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-select {
            padding: 10px 15px;
            border: 2px solid var(--dk-gray);
            border-radius: 8px;
            font-size: 16px;
            background: var(--dk-white);
            color: var(--dk-text);
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--dk-primary);
            box-shadow: 0 0 0 3px rgba(188, 219, 228, 0.3);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--dk-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #002A3A;
            transform: translateY(-2px);
            box-shadow: var(--dk-shadow-hover);
        }

        .btn-accent {
            background: var(--dk-accent);
            color: white;
        }

        /* æª¢è¦–åˆ‡æ› */
        .view-toggle {
            background: var(--dk-white);
            border-radius: var(--dk-radius);
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: var(--dk-shadow);
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .view-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--dk-gray-dark);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: var(--dk-primary);
            color: white;
        }

        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--dk-white);
            padding: 20px;
            border-radius: var(--dk-radius);
            text-align: center;
            box-shadow: var(--dk-shadow);
            border-top: 3px solid var(--dk-accent);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dk-primary);
        }

        .stat-label {
            font-size: 14px;
            color: var(--dk-gray-dark);
            margin-top: 5px;
        }

        /* æ’ç­å¡ç‰‡ */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .schedule-card {
            background: var(--dk-white);
            border-radius: var(--dk-radius);
            overflow: hidden;
            box-shadow: var(--dk-shadow);
            transition: transform 0.3s ease;
        }

        .schedule-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--dk-shadow-hover);
        }

        .card-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--dk-primary), var(--dk-secondary));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-date {
            font-size: 20px;
            font-weight: 600;
        }

        .card-weekday {
            font-size: 14px;
            opacity: 0.9;
        }

        .today-badge {
            background: var(--dk-accent);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .card-body {
            padding: 20px;
        }

        .shift-item {
            padding: 12px;
            background: var(--dk-gray-light);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .shift-time {
            font-size: 18px;
            font-weight: 600;
            color: var(--dk-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shift-employees {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .employee-badge {
            background: var(--dk-light);
            color: var(--dk-primary);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 500;
        }

        .employee-badge.me {
            background: var(--dk-accent);
            color: white;
            font-weight: 600;
        }

        /* ç©ºç‹€æ…‹ */
        .empty-state {
            background: var(--dk-white);
            border-radius: var(--dk-radius);
            padding: 60px 20px;
            text-align: center;
            box-shadow: var(--dk-shadow);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dk-primary);
        }

        .empty-text {
            color: var(--dk-gray-dark);
        }

        .no-schedule {
            text-align: center;
            color: var(--dk-gray-dark);
            padding: 30px;
        }

        /* åˆ—è¡¨æª¢è¦– */
        .list-view {
            background: var(--dk-white);
            border-radius: var(--dk-radius);
            overflow: hidden;
            box-shadow: var(--dk-shadow);
        }

        .list-header {
            display: grid;
            grid-template-columns: 100px 150px 1fr 100px;
            padding: 15px 20px;
            background: var(--dk-gray-light);
            font-weight: 600;
            font-size: 14px;
            color: var(--dk-gray-dark);
            border-bottom: 2px solid var(--dk-light);
        }

        .list-item {
            display: grid;
            grid-template-columns: 100px 150px 1fr 100px;
            padding: 15px 20px;
            border-bottom: 1px solid var(--dk-gray);
            align-items: center;
            transition: background 0.3s ease;
        }

        .list-item:hover {
            background: var(--dk-gray-light);
        }

        .list-date {
            font-weight: 600;
            color: var(--dk-primary);
        }

        .list-time {
            color: var(--dk-accent);
            font-weight: 500;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid var(--dk-gray);
            border-top-color: var(--dk-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }
            
            .schedule-grid {
                grid-template-columns: 1fr;
            }

            .control-group {
                flex-direction: column;
                align-items: stretch;
            }

            .form-select {
                width: 100%;
            }

            .list-header,
            .list-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .list-header {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œå€ -->
        <div class="header">
            <h1>ğŸ“… æ’ç­æŸ¥è©¢ç³»çµ±</h1>
            <p>æŸ¥çœ‹æ‚¨çš„æ’ç­è³‡è¨Š - Bleu</p>
            <div class="last-update" id="lastUpdate">
                æœ€å¾Œæ›´æ–°ï¼šè¼‰å…¥ä¸­...
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="control-group">
                <select class="form-select" id="employeeSelect">
                    <option value="">é¸æ“‡å“¡å·¥æŸ¥çœ‹æ’ç­</option>
                    <option value="all">æŸ¥çœ‹æ‰€æœ‰å“¡å·¥</option>
                </select>
                <select class="form-select" id="monthSelect">
                    <!-- å‹•æ…‹ç”Ÿæˆæœˆä»½é¸é … -->
                </select>
                <button class="btn btn-primary" onclick="EmployeeView.loadSchedule()">
                    ğŸ” æŸ¥è©¢æ’ç­
                </button>
                <button class="btn btn-accent" onclick="EmployeeView.refresh()">
                    ğŸ”„ é‡æ–°æ•´ç†
                </button>
            </div>
        </div>

        <!-- çµ±è¨ˆå€ -->
        <div class="stats-container" id="statsContainer" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalShifts">0</div>
                <div class="stat-label">æœ¬æœˆç¸½ç­æ¬¡</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalHours">0</div>
                <div class="stat-label">ç¸½å·¥æ™‚ï¼ˆå°æ™‚ï¼‰</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="morningShifts">0</div>
                <div class="stat-label">æ—©ç­æ¬¡æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="eveningShifts">0</div>
                <div class="stat-label">æ™šç­æ¬¡æ•¸</div>
            </div>
        </div>

        <!-- æª¢è¦–åˆ‡æ› -->
        <div class="view-toggle" id="viewToggle" style="display: none;">
            <button class="view-btn active" onclick="EmployeeView.switchView('grid')">ğŸ“… å¡ç‰‡æª¢è¦–</button>
            <button class="view-btn" onclick="EmployeeView.switchView('list')">ğŸ“‹ åˆ—è¡¨æª¢è¦–</button>
        </div>

        <!-- æ’ç­é¡¯ç¤ºå€ -->
        <div id="scheduleContent">
            <div class="empty-state">
                <div class="empty-icon">ğŸ‘†</div>
                <div class="empty-title">è«‹é¸æ“‡å“¡å·¥</div>
                <div class="empty-text">é¸æ“‡å“¡å·¥å’Œæœˆä»½ä»¥æŸ¥çœ‹æ’ç­è³‡è¨Š</div>
            </div>
        </div>
    </div>

    <script>
        // å“¡å·¥æª¢è¦–æ‡‰ç”¨ç¨‹å¼
        const EmployeeView = {
            employees: [],
            schedules: {},
            shifts: [],
            currentView: 'grid',
            selectedEmployee: null,
            selectedMonth: null,
            
            init() {
                this.loadData();
                this.setupMonthSelector();
                this.renderEmployeeSelector();
                this.updateLastSync();
                
                // æ¯30ç§’è‡ªå‹•æ›´æ–°
                setInterval(() => {
                    this.refresh();
                }, 30000);
            },
            
            loadData() {
                const saved = localStorage.getItem('scheduleData');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.employees = data.employees || [];
                    this.schedules = data.schedules || {};
                    this.shifts = data.shifts || [];
                }
            },
            
            setupMonthSelector() {
                const select = document.getElementById('monthSelect');
                const currentDate = new Date();
                const currentYear = currentDate.getFullYear();
                const currentMonth = currentDate.getMonth();
                
                for (let i = -3; i <= 3; i++) {
                    const date = new Date(currentYear, currentMonth + i, 1);
                    const option = document.createElement('option');
                    option.value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    option.textContent = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ`;
                    
                    if (i === 0) {
                        option.selected = true;
                        this.selectedMonth = option.value;
                    }
                    
                    select.appendChild(option);
                }
                
                select.onchange = (e) => {
                    this.selectedMonth = e.target.value;
                };
            },
            
            renderEmployeeSelector() {
                const select = document.getElementById('employeeSelect');
                
                while (select.options.length > 2) {
                    select.remove(2);
                }
                
                this.employees.forEach(emp => {
                    const option = document.createElement('option');
                    option.value = emp.id;
                    option.textContent = `${emp.name} (${emp.type === 'fulltime' ? 'æ­£è·' : 'PT'})`;
                    select.appendChild(option);
                });
                
                select.onchange = (e) => {
                    this.selectedEmployee = e.target.value;
                };
            },
            
            updateLastSync() {
                const saved = localStorage.getItem('scheduleData');
                if (saved) {
                    const data = JSON.parse(saved);
                    const lastUpdate = new Date(data.lastUpdated);
                    document.getElementById('lastUpdate').textContent = 
                        `æœ€å¾Œæ›´æ–°ï¼š${lastUpdate.toLocaleString('zh-TW')}`;
                }
            },
            
            refresh() {
                this.loadData();
                this.renderEmployeeSelector();
                this.updateLastSync();
                if (this.selectedEmployee) {
                    this.loadSchedule();
                }
            },
            
            loadSchedule() {
                if (!this.selectedEmployee || !this.selectedMonth) {
                    this.showEmpty('è«‹é¸æ“‡å“¡å·¥å’Œæœˆä»½');
                    return;
                }
                
                document.getElementById('statsContainer').style.display = 'grid';
                document.getElementById('viewToggle').style.display = 'flex';
                
                const schedules = this.getEmployeeSchedules();
                this.updateStats(schedules);
                
                if (schedules.length === 0) {
                    this.showEmpty('æœ¬æœˆç„¡æ’ç­');
                } else {
                    this.renderSchedules(schedules);
                }
            },
            
            getEmployeeSchedules() {
                const schedules = [];
                
                Object.entries(this.schedules).forEach(([date, daySchedules]) => {
                    if (date.startsWith(this.selectedMonth)) {
                        daySchedules.forEach(schedule => {
                            if (this.selectedEmployee === 'all' || 
                                schedule.employeeId == this.selectedEmployee) {
                                schedules.push({
                                    date,
                                    ...schedule,
                                    employeeName: this.getEmployeeName(schedule.employeeId)
                                });
                            }
                        });
                    }
                });
                
                return schedules.sort((a, b) => a.date.localeCompare(b.date));
            },
            
            updateStats(schedules) {
                let totalHours = 0;
                let morningCount = 0;
                let eveningCount = 0;
                
                schedules.forEach(schedule => {
                    const hours = this.calculateHours(schedule.startTime, schedule.endTime);
                    totalHours += hours;
                    
                    const startHour = parseInt(schedule.startTime.split(':')[0]);
                    if (startHour < 12) {
                        morningCount++;
                    } else {
                        eveningCount++;
                    }
                });
                
                document.getElementById('totalShifts').textContent = schedules.length;
                document.getElementById('totalHours').textContent = Math.round(totalHours);
                document.getElementById('morningShifts').textContent = morningCount;
                document.getElementById('eveningShifts').textContent = eveningCount;
            },
            
            calculateHours(startTime, endTime) {
                const [startH, startM] = startTime.split(':').map(Number);
                const [endH, endM] = endTime.split(':').map(Number);
                
                let hours = endH - startH;
                let minutes = endM - startM;
                
                if (minutes < 0) {
                    hours--;
                    minutes += 60;
                }
                
                if (hours < 0) {
                    hours += 24;
                }
                
                return hours + minutes / 60;
            },
            
            renderSchedules(schedules) {
                const content = document.getElementById('scheduleContent');
                
                if (this.currentView === 'grid') {
                    this.renderGridView(schedules, content);
                } else {
                    this.renderListView(schedules, content);
                }
            },
            
            renderGridView(schedules, container) {
                const groupedSchedules = {};
                schedules.forEach(schedule => {
                    if (!groupedSchedules[schedule.date]) {
                        groupedSchedules[schedule.date] = [];
                    }
                    groupedSchedules[schedule.date].push(schedule);
                });
                
                let html = '<div class="schedule-grid">';
                
                Object.entries(groupedSchedules).forEach(([date, daySchedules]) => {
                    const dateObj = new Date(date + 'T00:00:00');
                    const weekdays = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
                    const isToday = date === new Date().toISOString().split('T')[0];
                    
                    html += `
                        <div class="schedule-card">
                            <div class="card-header">
                                <div>
                                    <div class="card-date">${dateObj.getDate()}æ—¥</div>
                                    <div class="card-weekday">${weekdays[dateObj.getDay()]}</div>
                                </div>
                                ${isToday ? '<span class="today-badge">ä»Šå¤©</span>' : ''}
                            </div>
                            <div class="card-body">
                    `;
                    
                    const timeGroups = {};
                    daySchedules.forEach(schedule => {
                        const key = `${schedule.startTime}-${schedule.endTime}`;
                        if (!timeGroups[key]) {
                            timeGroups[key] = [];
                        }
                        timeGroups[key].push(schedule);
                    });
                    
                    Object.entries(timeGroups).forEach(([time, schedules]) => {
                        html += `
                            <div class="shift-item">
                                <div class="shift-time">
                                    ğŸ• ${time}
                                </div>
                                <div class="shift-employees">
                        `;
                        
                        schedules.forEach(schedule => {
                            const isMe = schedule.employeeId == this.selectedEmployee;
                            html += `<span class="employee-badge ${isMe ? 'me' : ''}">${schedule.employeeName}</span>`;
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            },
            
            renderListView(schedules, container) {
                let html = `
                    <div class="list-view">
                        <div class="list-header">
                            <div>æ—¥æœŸ</div>
                            <div>æ™‚é–“</div>
                            <div>å“¡å·¥</div>
                            <div>å·¥æ™‚</div>
                        </div>
                `;
                
                schedules.forEach(schedule => {
                    const dateObj = new Date(schedule.date + 'T00:00:00');
                    const hours = this.calculateHours(schedule.startTime, schedule.endTime);
                    
                    html += `
                        <div class="list-item">
                            <div class="list-date">${dateObj.getMonth() + 1}/${dateObj.getDate()}</div>
                            <div class="list-time">${schedule.startTime} - ${schedule.endTime}</div>
                            <div>${schedule.employeeName}</div>
                            <div>${hours.toFixed(1)}h</div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            },
            
            switchView(view) {
                this.currentView = view;
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                if (this.selectedEmployee) {
                    this.loadSchedule();
                }
            },
            
            showEmpty(message) {
                document.getElementById('statsContainer').style.display = 'none';
                document.getElementById('viewToggle').style.display = 'none';
                document.getElementById('scheduleContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <div class="empty-title">${message}</div>
                        <div class="empty-text">è«‹ç¢ºèªé¸æ“‡æ¢ä»¶æˆ–è¯ç¹«ç®¡ç†å“¡</div>
                    </div>
                `;
            },
            
            getEmployeeName(id) {
                const emp = this.employees.find(e => e.id == id);
                return emp ? emp.name : 'æœªçŸ¥';
            }
        };
        
        // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
        document.addEventListener('DOMContentLoaded', () => {
            EmployeeView.init();
        });
    </script>
</body>
</html>
